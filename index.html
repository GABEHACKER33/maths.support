<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Quest - Educational Math Games</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5b21b6;
            --primary-dark: #4c1d95;
            --accent: #0ea5e9;
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --text: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        body.dark {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --accent: #38bdf8;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.3);
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: background 0.4s, color 0.4s;
        }

        header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .nav-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }

        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        h1 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .game-card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .game-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }

        .thumbnail {
            height: 160px;
            background: #000;
            position: relative;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 999px;
            font-size: 0.8rem;
        }

        .info {
            padding: 1.2rem;
        }

        .title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            max-height: 95vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.4);
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tab-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
        }

        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 500;
            color: var(--text-muted);
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--bg-card);
        }

        .tab-content {
            flex: 1;
            display: none;
            overflow: hidden;
        }

        .tab-content.active {
            display: block;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .close-btn {
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-muted);
        }

        .close-btn:hover { color: var(--primary); }

        @media (max-width: 768px) {
            .nav-bar { flex-direction: column; gap: 1rem; }
            .nav-links { flex-wrap: wrap; justify-content: center; }
            main { padding: 0 1rem; }
        }
    </style>
</head>
<body>

<header>
    <div class="nav-bar">
        <div class="logo">Math Quest</div>
        <div class="nav-links">
            <a href="#" class="active" data-page="games">Games</a>
            <a href="#" data-page="recent">Recent</a>
            <a href="#" data-page="settings">Settings</a>
        </div>
    </div>
</header>

<main>

    <!-- Games Section -->
    <section id="games" class="page active">
        <h1>Math Games Collection</h1>
        <p class="subtitle">Practice addition, fractions, geometry, multiplication and more — all free in your browser</p>
        <div class="games-grid" id="gamesGrid"></div>
    </section>

    <!-- Recent / Placeholder for now -->
    <section id="recent" class="page" style="display:none;">
        <h1>Recently Played</h1>
        <p class="subtitle">Quick access to your last opened games</p>
        <div class="games-grid" id="recentGrid"></div>
    </section>

    <!-- Settings -->
    <section id="settings" class="page" style="display:none;">
        <h1>Settings</h1>
        <div style="background:var(--bg-card); padding:2rem; border-radius:16px; border:1px solid var(--border); max-width:600px;">
            <h3 style="margin-bottom:1rem;">Appearance</h3>
            <label style="display:flex; align-items:center; gap:1rem; margin-bottom:1.5rem;">
                <input type="checkbox" id="darkToggle" checked>
                Dark Mode
            </label>

            <h3 style="margin:2rem 0 1rem;">Game Tabs</h3>
            <label style="display:flex; align-items:center; gap:1rem;">
                <input type="checkbox" id="closeOnSwitch" checked>
                Auto-close other tabs when switching
            </label>
        </div>
    </section>

</main>

<!-- Game Modal with Tabs -->
<div class="modal" id="gameModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Game</h2>
            <span class="close-btn" id="closeModal">×</span>
        </div>
        <div class="tab-container">
            <div class="tabs" id="gameTabs"></div>
            <div class="tab-content-wrapper" id="tabContents"></div>
        </div>
    </div>
</div>

<script>
    // Expanded real math games list
    const games = [
        {id:'alien-add', title:'Alien Addition', cat:'Addition', url:'https://www.coolmath4kids.com/math-games/alien-addition'},
        {id:'grand-prix-mult', title:'Grand Prix Multiplication', cat:'Multiplication', url:'https://www.coolmath4kids.com/math-games/grand-prix-multiplication'},
        {id:'dirt-bike-frac', title:'Dirt Bike Fractions', cat:'Fractions', url:'https://www.coolmath4kids.com/math-games/dirt-bike-fractions'},
        {id:'jet-ski-add', title:'Jet Ski Addition', cat:'Addition', url:'https://www.coolmath4kids.com/math-games/jet-ski-addition'},
        {id:'demol-div', title:'Demolition Division', cat:'Division', url:'https://www.coolmath4kids.com/math-games/demolition-division'},
        {id:'math-slither', title:'Math Slither', cat:'Arithmetic', url:'https://www.mathgames.com/play/math-slither.html'},
        {id:'frac-tiles', title:'Fraction Tiles', cat:'Fractions', url:'https://www.mathplayground.com/fraction_tiles.html'},
        {id:'mult-grand-prix', title:'Multiplication Grand Prix', cat:'Multiplication', url:'https://www.mathplayground.com/ASB_MultiplicationGrandPrix.html'},
        {id:'island-sub', title:'Island Chase Subtraction', cat:'Subtraction', url:'https://www.coolmath4kids.com/math-games/island-chase-subtraction'},
        {id:'pup-kitten-dec', title:'Puppies & Kittens Decimals', cat:'Decimals', url:'https://www.mathplayground.com/ASB_Puppies_Kittens.html'},
        {id:'sum-blocks', title:'Sum Blocks', cat:'Addition', url:'https://www.mathplayground.com/sum_blocks.html'},
        {id:'math-monster', title:'Math Monster', cat:'Mixed', url:'https://www.mathplayground.com/math_monster.html'}
    ];

    let openTabs = [];          // {id, title, url, tabEl, contentEl}
    let currentTabId = null;
    let recentGames = JSON.parse(localStorage.getItem('recentMathGames')) || [];

    const modal = document.getElementById('gameModal');
    const modalTitle = document.getElementById('modalTitle');
    const tabsContainer = document.getElementById('gameTabs');
    const contentsContainer = document.getElementById('tabContents');
    const closeModalBtn = document.getElementById('closeModal');

    // Render main games grid
    function renderGames(containerId = 'gamesGrid') {
        const grid = document.getElementById(containerId);
        grid.innerHTML = games.map(game => `
            <div class="game-card" data-id="${game.id}">
                <div class="thumbnail">
                    <img src="https://images.unsplash.com/photo-1581092160560-1c1e428e9d65?w=400&h=300&fit=crop" alt="${game.title}" onerror="this.style.display='none'">
                    <span class="badge">${game.cat}</span>
                </div>
                <div class="info">
                    <div class="title">${game.title}</div>
                </div>
            </div>
        `).join('');
    }

    renderGames();

    // Open game → add tab or switch
    function openGame(game) {
        const existing = openTabs.find(t => t.id === game.id);
        if (existing) {
            switchToTab(existing.id);
            modal.classList.add('active');
            return;
        }

        // Add new tab
        const tabId = game.id;
        const tabEl = document.createElement('div');
        tabEl.className = 'tab';
        tabEl.textContent = game.title;
        tabEl.dataset.tabId = tabId;
        tabEl.onclick = () => switchToTab(tabId);

        const closeTab = document.createElement('span');
        closeTab.textContent = ' ×';
        closeTab.style.marginLeft = '8px';
        closeTab.style.cursor = 'pointer';
        closeTab.onclick = (e) => { e.stopPropagation(); closeTabFunc(tabId); };
        tabEl.appendChild(closeTab);

        const contentEl = document.createElement('div');
        contentEl.className = 'tab-content';
        contentEl.dataset.tabId = tabId;
        contentEl.innerHTML = `<iframe src="${game.url}" allowfullscreen></iframe>`;

        tabsContainer.appendChild(tabEl);
        contentsContainer.appendChild(contentEl);

        openTabs.push({id: tabId, title: game.title, url: game.url, tabEl, contentEl});

        switchToTab(tabId);
        modal.classList.add('active');

        // Save to recent
        recentGames = [game.id, ...recentGames.filter(id => id !== game.id)].slice(0,6);
        localStorage.setItem('recentMathGames', JSON.stringify(recentGames));
        updateRecent();
    }

    function switchToTab(tabId) {
        openTabs.forEach(t => {
            t.tabEl.classList.toggle('active', t.id === tabId);
            t.contentEl.classList.toggle('active', t.id === tabId);
        });
        currentTabId = tabId;
        modalTitle.textContent = openTabs.find(t => t.id === tabId)?.title || 'Game';
    }

    function closeTabFunc(tabId) {
        const idx = openTabs.findIndex(t => t.id === tabId);
        if (idx === -1) return;

        const tab = openTabs[idx];
        tab.tabEl.remove();
        tab.contentEl.remove();
        openTabs.splice(idx, 1);

        if (currentTabId === tabId) {
            if (openTabs.length > 0) {
                switchToTab(openTabs[openTabs.length-1].id);
            } else {
                modal.classList.remove('active');
            }
        }
    }

    // Close modal
    closeModalBtn.onclick = () => modal.classList.remove('active');

    modal.onclick = e => {
        if (e.target === modal) modal.classList.remove('active');
    };

    // Navigation
    document.querySelectorAll('.nav-links a').forEach(link => {
        link.onclick = e => {
            e.preventDefault();
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            link.classList.add('active');

            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(link.dataset.page).style.display = 'block';

            if (link.dataset.page === 'recent') updateRecent();
        };
    });

    // Card clicks
    document.addEventListener('click', e => {
        const card = e.target.closest('.game-card');
        if (!card) return;
        const id = card.dataset.id;
        const game = games.find(g => g.id === id);
        if (game) openGame(game);
    });

    // Recent grid
    function updateRecent() {
        const grid = document.getElementById('recentGrid');
        const recents = recentGames.map(id => games.find(g => g.id === id)).filter(Boolean);
        grid.innerHTML = recents.length ? recents.map(game => `
            <div class="game-card" data-id="${game.id}">
                <div class="thumbnail">
                    <img src="https://images.unsplash.com/photo-1581092160560-1c1e428e9d65?w=400&h=300&fit=crop" alt="${game.title}">
                    <span class="badge">${game.cat}</span>
                </div>
                <div class="info">
                    <div class="title">${game.title}</div>
                </div>
            </div>
        `).join('') : '<p style="color:var(--text-muted); text-align:center; padding:3rem 0;">No recent games yet.</p>';
    }

    // Dark mode
    const darkToggle = document.getElementById('darkToggle');
    darkToggle.checked = localStorage.getItem('darkMode') !== 'false';
    if (darkToggle.checked) document.body.classList.add('dark');

    darkToggle.onchange = () => {
        document.body.classList.toggle('dark', darkToggle.checked);
        localStorage.setItem('darkMode', darkToggle.checked);
    };

    // Init
    if (recentGames.length) updateRecent();
</script>
</body>
</html>
