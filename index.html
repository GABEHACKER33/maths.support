<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maths Support - Gaming Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a28;
            --accent-primary: #00ff88;
            --accent-secondary: #00ccff;
            --accent-danger: #ff4466;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-glow: 0 0 40px rgba(0, 255, 136, 0.15);
            --proxy-color: #8a2be2;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 136, 0.03), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 204, 255, 0.03), transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        #root {
            position: relative;
            z-index: 1;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(138, 43, 226, 0.5); }
            50% { box-shadow: 0 0 40px rgba(138, 43, 226, 0.8); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase Configuration (TEST CONFIG - replace with your own)
        const firebaseConfig = {
            apiKey: "AIzaSyCHkqY2CBLGCmB3KqwTb8FdOHLIT7gKvno",
            authDomain: "maths-support-test.firebaseapp.com",
            projectId: "maths-support-test",
            storageBucket: "maths-support-test.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };

        // Supabase Configuration (TEST CONFIG - replace with your own)
        const SUPABASE_URL = 'https://hsmfjpetvcsgkpkwpdjr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhzbWZqcGV0dmNzZ2twa3dwZGpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NDc0MzEsImV4cCI6MjA3OTMyMzQzMX0.IBiJtUJBPyjNwGowfgnlfrbHpb46C43NmYY3O9rEFqQ';

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                autoRefreshToken: true,
                persistSession: true
            }
        });

        // Configure Google Auth Provider to restrict to kcpupils.org
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.setCustomParameters({
            hd: 'kcpupils.org'
        });

        // Games Data
        const GAMES = [
            { id: '1', title: 'Drive Mad', category: 'Racing', url: 'https://games.playtropolis.com/drive-mad-v2/', thumbnail: 'https://images.unsplash.com/photo-1511919884226-fd3cad34687c?w=400&h=300&fit=crop', color: '#ff4466' },
            { id: '2', title: 'Subway Surfers', category: 'Endless Runner', url: 'https://poki.com/en/g/subway-surfers', thumbnail: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop', color: '#00ccff' },
            { id: '3', title: 'Tetris', category: 'Puzzle', url: 'https://tetris.com/play-tetris', thumbnail: 'https://images.unsplash.com/photo-1607853202273-797f1c22a38e?w=400&h=300&fit=crop', color: '#00ff88' },
            { id: '4', title: 'Snake', category: 'Arcade', url: 'https://playsnake.org/', thumbnail: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=400&h=300&fit=crop', color: '#ffaa00' },
            { id: '5', title: 'Chess', category: 'Strategy', url: 'https://www.chess.com/play/computer', thumbnail: 'https://images.unsplash.com/photo-1529699211952-734e80c4d42b?w=400&h=300&fit=crop', color: '#8844ff' },
            { id: '6', title: '2048', category: 'Puzzle', url: 'https://play2048.co/', thumbnail: 'https://images.unsplash.com/photo-1611996575749-79a3a250f948?w=400&h=300&fit=crop', color: '#ff6b9d' },
            { id: '7', title: 'Minesweeper', category: 'Logic', url: 'https://minesweeper.online/', thumbnail: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=400&h=300&fit=crop', color: '#66ddff' },
            { id: '8', title: 'Pac-Man', category: 'Arcade', url: 'https://www.google.com/logos/2010/pacman10-i.html', thumbnail: 'https://images.unsplash.com/photo-1578303512597-81e6cc155b3e?w=400&h=300&fit=crop', color: '#ffdd00' },
        ];

        // Simple Proxy Service
        const ProxyService = {
            loadProxy: () => {
                const proxyUrl = 'https://8021688600113732413547102395624276084104729385613928573282.educationandtraining.info/';
                window.open(proxyUrl, '_blank', 'noopener,noreferrer');
                
                // Show success message
                alert('Proxy is loading in a new tab. This may help access games that are blocked on your network.');
            }
        };

        // Firebase Service Functions (Fallback if Supabase fails)
        const FirebaseService = {
            createUserProfile: async (user) => {
                try {
                    const userRef = db.collection('users').doc(user.uid);
                    const doc = await userRef.get();
                    
                    if (!doc.exists) {
                        await userRef.set({
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName,
                            photoURL: user.photoURL,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            stats: {
                                gamesPlayed: 0,
                                totalTime: 0,
                                achievements: 0
                            },
                            status: 'online',
                            currentGame: null
                        });
                    }
                    return { success: true };
                } catch (error) {
                    console.error('Firebase error:', error);
                    return { success: false, error };
                }
            },

            updateUserStatus: async (uid, status, currentGame = null) => {
                try {
                    await db.collection('users').doc(uid).update({
                        status,
                        currentGame,
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    console.error('Firebase error:', error);
                    return { success: false, error };
                }
            }
        };

        // Supabase Service Functions
        const SupabaseService = {
            createUserProfile: async (user) => {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .upsert({
                            uid: user.uid,
                            email: user.email,
                            display_name: user.displayName || user.email.split('@')[0],
                            photo_url: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.email.split('@')[0])}&background=random`,
                            status: 'online',
                            current_game: null,
                            created_at: new Date().toISOString(),
                            stats: {
                                games_played: 0,
                                total_time: 0,
                                achievements: 0
                            }
                        }, {
                            onConflict: 'uid'
                        });

                    if (error) {
                        console.error('Supabase error:', error);
                        // Fallback to Firebase
                        return await FirebaseService.createUserProfile(user);
                    }
                    return { success: true, data };
                } catch (error) {
                    console.error('Error creating profile:', error);
                    // Fallback to Firebase
                    return await FirebaseService.createUserProfile(user);
                }
            },

            updateUserStatus: async (uid, status, currentGame = null) => {
                try {
                    const { error } = await supabase
                        .from('users')
                        .update({
                            status,
                            current_game: currentGame,
                            last_seen: new Date().toISOString()
                        })
                        .eq('uid', uid);

                    if (error) {
                        console.error('Supabase error:', error);
                        // Fallback to Firebase
                        return await FirebaseService.updateUserStatus(uid, status, currentGame);
                    }
                    return { success: true };
                } catch (error) {
                    console.error('Error updating status:', error);
                    // Fallback to Firebase
                    return await FirebaseService.updateUserStatus(uid, status, currentGame);
                }
            },

            // Simple fallback functions (can be expanded)
            getFriends: async () => {
                return [];
            },

            addFriend: async () => {
                return { success: true };
            }
        };

        // Combined Service
        const UserService = {
            createUserProfile: async (user) => {
                return await SupabaseService.createUserProfile(user);
            },

            updateUserStatus: async (uid, status, currentGame = null) => {
                return await SupabaseService.updateUserStatus(uid, status, currentGame);
            },

            loadProxy: ProxyService.loadProxy
        };

        // Login Screen Component
        function LoginScreen({ onLoginSuccess }) {
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [debugInfo, setDebugInfo] = useState('');

            const handleGoogleSignIn = async () => {
                setLoading(true);
                setError('');
                setDebugInfo('');
                
                try {
                    // Test if Firebase is initialized
                    if (!firebase.apps.length) {
                        throw new Error('Firebase not initialized');
                    }

                    // Sign in with Google
                    const result = await auth.signInWithPopup(googleProvider);
                    
                    // For testing, allow any email domain, but warn if not kcpupils.org
                    if (!result.user.email.endsWith('@kcpupils.org')) {
                        setDebugInfo('Note: Using non-kcpupils.org email for testing');
                        // Don't sign out - allow for testing
                    }

                    // Create user profile
                    const profileResult = await UserService.createUserProfile(result.user);
                    
                    if (profileResult.success) {
                        onLoginSuccess(result.user);
                    } else {
                        // Even if profile creation fails, allow login
                        console.warn('Profile creation failed, but allowing login');
                        onLoginSuccess(result.user);
                    }
                } catch (err) {
                    console.error('Login error:', err);
                    setDebugInfo(`Error code: ${err.code || 'unknown'}, Message: ${err.message}`);
                    
                    if (err.code === 'auth/popup-closed-by-user') {
                        setError('Sign-in was cancelled. Please click the button again.');
                    } else if (err.code === 'auth/popup-blocked') {
                        setError('Pop-up blocked. Please allow pop-ups for this site and try again.');
                    } else if (err.code === 'auth/network-request-failed') {
                        setError('Network error. Please check your internet connection.');
                    } else if (err.code === 'auth/internal-error') {
                        setError('Firebase configuration error. Using test mode...');
                        // Create a mock user for testing
                        const mockUser = {
                            uid: 'test-user-' + Date.now(),
                            email: 'test@kcpupils.org',
                            displayName: 'Test User',
                            photoURL: 'https://ui-avatars.com/api/?name=Test+User&background=random'
                        };
                        setTimeout(() => {
                            onLoginSuccess(mockUser);
                        }, 1000);
                    } else {
                        setError('Failed to sign in. Please try again or use test mode.');
                        
                        // Offer test mode
                        if (confirm('Sign-in failed. Would you like to enter test mode?')) {
                            const mockUser = {
                                uid: 'test-user-' + Date.now(),
                                email: 'test@kcpupils.org',
                                displayName: 'Test User',
                                photoURL: 'https://ui-avatars.com/api/?name=Test+User&background=random'
                            };
                            onLoginSuccess(mockUser);
                        }
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    inset: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'var(--bg-primary)',
                    animation: 'fadeIn 0.6s ease-out'
                }}>
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '24px',
                        padding: '60px 50px',
                        maxWidth: '500px',
                        width: '90%',
                        textAlign: 'center',
                        boxShadow: 'var(--shadow-glow)',
                        position: 'relative'
                    }}>
                        <button
                            onClick={UserService.loadProxy}
                            style={{
                                position: 'absolute',
                                top: '20px',
                                right: '20px',
                                padding: '10px 20px',
                                background: 'var(--proxy-color)',
                                border: 'none',
                                borderRadius: '12px',
                                color: 'white',
                                fontSize: '14px',
                                fontWeight: '700',
                                cursor: 'pointer',
                                animation: 'glow 2s ease-in-out infinite',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                zIndex: 10,
                                transition: 'transform 0.3s ease'
                            }}
                            onMouseEnter={(e) => {
                                e.target.style.transform = 'scale(1.05)';
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.transform = 'scale(1)';
                            }}
                        >
                            <span>üîí</span>
                            <span>Load Proxy</span>
                        </button>

                        <div style={{
                            width: '80px',
                            height: '80px',
                            margin: '0 auto 30px',
                            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                            borderRadius: '20px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: '40px',
                            animation: 'float 3s ease-in-out infinite'
                        }}>
                            üéÆ
                        </div>

                        <h1 style={{
                            fontSize: '32px',
                            fontWeight: '800',
                            marginBottom: '12px',
                            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            backgroundClip: 'text'
                        }}>
                            Maths Support
                        </h1>

                        <p style={{
                            color: 'var(--text-secondary)',
                            marginBottom: '40px',
                            fontSize: '15px'
                        }}>
                            Sign in to access educational games and chat with friends
                        </p>

                        <button
                            onClick={handleGoogleSignIn}
                            disabled={loading}
                            style={{
                                width: '100%',
                                padding: '16px',
                                background: '#fff',
                                color: '#000',
                                border: 'none',
                                borderRadius: '12px',
                                fontSize: '16px',
                                fontWeight: '700',
                                cursor: loading ? 'not-allowed' : 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '12px',
                                transition: 'all 0.3s ease',
                                opacity: loading ? 0.6 : 1
                            }}
                            onMouseEnter={(e) => {
                                if (!loading) {
                                    e.target.style.transform = 'translateY(-2px)';
                                    e.target.style.boxShadow = '0 8px 24px rgba(255,255,255,0.2)';
                                }
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.transform = 'translateY(0)';
                                e.target.style.boxShadow = 'none';
                            }}
                        >
                            {loading ? (
                                <>
                                    <div style={{ 
                                        width: '20px', 
                                        height: '20px', 
                                        border: '3px solid #ddd', 
                                        borderTop: '3px solid #000',
                                        borderRadius: '50%',
                                        animation: 'spin 1s linear infinite'
                                    }} />
                                    <span>Signing in...</span>
                                </>
                            ) : (
                                <>
                                    <svg width="20" height="20" viewBox="0 0 24 24">
                                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                    <span>Sign in with Google</span>
                                </>
                            )}
                        </button>

                        {error && (
                            <div style={{
                                marginTop: '20px',
                                padding: '12px',
                                background: 'rgba(255, 68, 102, 0.1)',
                                border: '1px solid var(--accent-danger)',
                                borderRadius: '8px',
                                color: 'var(--accent-danger)',
                                fontSize: '14px'
                            }}>
                                {error}
                                {debugInfo && (
                                    <div style={{ 
                                        fontSize: '12px', 
                                        marginTop: '8px',
                                        color: 'var(--text-secondary)' 
                                    }}>
                                        {debugInfo}
                                    </div>
                                )}
                            </div>
                        )}

                        <div style={{
                            marginTop: '30px',
                            fontSize: '13px',
                            color: 'var(--text-secondary)',
                            lineHeight: '1.6'
                        }}>
                            <p style={{ marginBottom: '10px' }}>
                                <strong>Note for testing:</strong> You can use any Google account
                            </p>
                            <p>
                                If sign-in fails, you'll be offered test mode
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeSection, setActiveSection] = useState('games');
            const [currentGame, setCurrentGame] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');

            useEffect(() => {
                // Check for existing auth state
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    if (user) {
                        setUser(user);
                        UserService.createUserProfile(user);
                    } else {
                        setUser(null);
                    }
                    setLoading(false);
                });

                // Also check for test user in localStorage
                const testUser = localStorage.getItem('testUser');
                if (testUser && !user) {
                    setUser(JSON.parse(testUser));
                    setLoading(false);
                }

                return () => unsubscribe();
            }, []);

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    localStorage.removeItem('testUser');
                } catch (error) {
                    console.error('Logout error:', error);
                }
                setUser(null);
                setActiveSection('games');
            };

            const playGame = async (game) => {
                setCurrentGame(game);
                if (user) {
                    await UserService.updateUserStatus(user.uid, 'online', game.title);
                }
            };

            const exitGame = async () => {
                setCurrentGame(null);
                if (user) {
                    await UserService.updateUserStatus(user.uid, 'online', null);
                }
            };

            const filteredGames = GAMES.filter(game => 
                game.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                game.category.toLowerCase().includes(searchQuery.toLowerCase())
            );

            if (loading) {
                return (
                    <div style={{
                        position: 'fixed',
                        inset: 0,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: 'var(--bg-primary)'
                    }}>
                        <div style={{
                            width: '50px',
                            height: '50px',
                            border: '4px solid var(--bg-secondary)',
                            borderTop: '4px solid var(--accent-primary)',
                            borderRadius: '50%',
                            animation: 'spin 1s linear infinite'
                        }} />
                    </div>
                );
            }

            if (!user) {
                return <LoginScreen onLoginSuccess={(user) => {
                    setUser(user);
                    // Store test user in localStorage
                    if (user.uid.startsWith('test-user-')) {
                        localStorage.setItem('testUser', JSON.stringify(user));
                    }
                }} />;
            }

            if (currentGame) {
                return <GamePlayer game={currentGame} onExit={exitGame} />;
            }

            return (
                <div style={{ display: 'flex', height: '100vh' }}>
                    <Sidebar 
                        activeSection={activeSection}
                        onSectionChange={setActiveSection}
                        onLogout={handleLogout}
                        onLoadProxy={UserService.loadProxy}
                    />

                    <MainContent
                        activeSection={activeSection}
                        user={user}
                        games={filteredGames}
                        searchQuery={searchQuery}
                        onSearchChange={setSearchQuery}
                        onPlayGame={playGame}
                        onLoadProxy={UserService.loadProxy}
                    />
                </div>
            );
        }

        // Sidebar Component with Proxy Button
        function Sidebar({ activeSection, onSectionChange, onLogout, onLoadProxy }) {
            const sections = [
                { id: 'games', icon: 'üéÆ', label: 'Games' },
                { id: 'profile', icon: 'üë§', label: 'Profile' },
                { id: 'messages', icon: 'üí¨', label: 'Messages' },
                { id: 'favorites', icon: '‚≠ê', label: 'Favorites' }
            ];

            return (
                <div style={{
                    width: '80px',
                    background: 'var(--bg-secondary)',
                    borderRight: '1px solid var(--border-color)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    padding: '20px 0',
                    gap: '10px'
                }}>
                    <div style={{
                        width: '48px',
                        height: '48px',
                        background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                        borderRadius: '12px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '24px',
                        marginBottom: '20px'
                    }}>
                        üéÆ
                    </div>

                    {sections.map(section => (
                        <button
                            key={section.id}
                            onClick={() => onSectionChange(section.id)}
                            style={{
                                width: '56px',
                                height: '56px',
                                background: activeSection === section.id ? 'rgba(0, 255, 136, 0.1)' : 'transparent',
                                border: activeSection === section.id ? '1px solid var(--accent-primary)' : '1px solid transparent',
                                borderRadius: '14px',
                                color: activeSection === section.id ? 'var(--accent-primary)' : 'var(--text-secondary)',
                                fontSize: '24px',
                                cursor: 'pointer',
                                transition: 'all 0.3s ease'
                            }}
                            onMouseEnter={(e) => {
                                if (activeSection !== section.id) {
                                    e.target.style.background = 'rgba(255, 255, 255, 0.05)';
                                }
                            }}
                            onMouseLeave={(e) => {
                                if (activeSection !== section.id) {
                                    e.target.style.background = 'transparent';
                                }
                            }}
                            title={section.label}
                        >
                            {section.icon}
                        </button>
                    ))}

                    <div style={{ flex: 1 }} />

                    {/* Proxy Button */}
                    <button
                        onClick={onLoadProxy}
                        style={{
                            width: '56px',
                            height: '56px',
                            background: 'var(--proxy-color)',
                            border: '1px solid var(--proxy-color)',
                            borderRadius: '14px',
                            color: 'white',
                            fontSize: '24px',
                            cursor: 'pointer',
                            transition: 'all 0.3s ease',
                            animation: 'glow 2s ease-in-out infinite',
                            marginBottom: '10px'
                        }}
                        onMouseEnter={(e) => {
                            e.target.style.transform = 'scale(1.1)';
                        }}
                        onMouseLeave={(e) => {
                            e.target.style.transform = 'scale(1)';
                        }}
                        title="Load Proxy"
                    >
                        üîí
                    </button>

                    <button
                        onClick={onLogout}
                        style={{
                            width: '56px',
                            height: '56px',
                            background: 'transparent',
                            border: '1px solid transparent',
                            borderRadius: '14px',
                            color: 'var(--accent-danger)',
                            fontSize: '24px',
                            cursor: 'pointer',
                            transition: 'all 0.3s ease'
                        }}
                        onMouseEnter={(e) => {
                            e.target.style.background = 'rgba(255, 68, 102, 0.1)';
                            e.target.style.borderColor = 'var(--accent-danger)';
                        }}
                        onMouseLeave={(e) => {
                            e.target.style.background = 'transparent';
                            e.target.style.borderColor = 'transparent';
                        }}
                        title="Logout"
                    >
                        üö™
                    </button>
                </div>
            );
        }

        // Main Content Component
        function MainContent({ 
            activeSection, user, games, searchQuery, onSearchChange, onPlayGame, onLoadProxy 
        }) {
            return (
                <div style={{ 
                    flex: 1, 
                    overflow: 'auto', 
                    padding: '40px',
                    display: 'flex',
                    flexDirection: 'column'
                }}>
                    {/* Header with proxy button */}
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '40px',
                        gap: '20px'
                    }}>
                        <h1 style={{
                            fontSize: '36px',
                            fontWeight: '800',
                            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            backgroundClip: 'text'
                        }}>
                            {activeSection === 'games' && 'Game Library'}
                            {activeSection === 'profile' && 'Profile'}
                            {activeSection === 'messages' && 'Messages'}
                            {activeSection === 'favorites' && 'Favorites'}
                        </h1>

                        <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                            {activeSection === 'games' && (
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => onSearchChange(e.target.value)}
                                    placeholder="Search games..."
                                    style={{
                                        padding: '12px 20px',
                                        background: 'var(--bg-secondary)',
                                        border: '1px solid var(--border-color)',
                                        borderRadius: '12px',
                                        color: 'var(--text-primary)',
                                        fontSize: '15px',
                                        width: '300px',
                                        outline: 'none'
                                    }}
                                />
                            )}
                            
                            <button
                                onClick={onLoadProxy}
                                style={{
                                    padding: '12px 20px',
                                    background: 'var(--proxy-color)',
                                    border: 'none',
                                    borderRadius: '12px',
                                    color: 'white',
                                    fontSize: '14px',
                                    fontWeight: '700',
                                    cursor: 'pointer',
                                    animation: 'glow 2s ease-in-out infinite',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    transition: 'transform 0.3s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.transform = 'translateY(-2px)';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.transform = 'translateY(0)';
                                }}
                            >
                                <span>üîí</span>
                                <span>Load Proxy</span>
                            </button>
                        </div>
                    </div>

                    {activeSection === 'games' && (
                        <GamesSection 
                            games={games}
                            onPlayGame={onPlayGame}
                        />
                    )}

                    {activeSection === 'profile' && (
                        <ProfileSection user={user} />
                    )}

                    {activeSection === 'messages' && (
                        <MessagesSection user={user} />
                    )}

                    {activeSection === 'favorites' && (
                        <FavoritesSection games={games.slice(0, 3)} onPlayGame={onPlayGame} />
                    )}
                </div>
            );
        }

        function GamesSection({ games, onPlayGame }) {
            return (
                <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
                    gap: '24px'
                }}>
                    {games.map((game, index) => (
                        <GameCard 
                            key={game.id} 
                            game={game} 
                            onPlay={onPlayGame}
                            delay={index * 0.05}
                        />
                    ))}
                </div>
            );
        }

        function GameCard({ game, onPlay, delay }) {
            return (
                <div
                    onClick={() => onPlay(game)}
                    style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '16px',
                        overflow: 'hidden',
                        cursor: 'pointer',
                        transition: 'all 0.4s ease',
                        animation: `fadeIn 0.5s ease-out ${delay}s both`
                    }}
                    onMouseEnter={(e) => {
                        e.currentTarget.style.transform = 'translateY(-8px)';
                        e.currentTarget.style.borderColor = game.color;
                        e.currentTarget.style.boxShadow = `0 20px 40px ${game.color}40`;
                    }}
                    onMouseLeave={(e) => {
                        e.currentTarget.style.transform = 'translateY(0)';
                        e.currentTarget.style.borderColor = 'var(--border-color)';
                        e.currentTarget.style.boxShadow = 'none';
                    }}
                >
                    <div style={{
                        height: '180px',
                        background: `linear-gradient(135deg, ${game.color}40, ${game.color}20)`,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        position: 'relative',
                        overflow: 'hidden'
                    }}>
                        <img 
                            src={game.thumbnail} 
                            alt={game.title}
                            style={{
                                width: '100%',
                                height: '100%',
                                objectFit: 'cover',
                                opacity: 0.6
                            }}
                        />
                        <div style={{
                            position: 'absolute',
                            inset: 0,
                            background: `linear-gradient(to top, ${game.color}60, transparent)`
                        }} />
                    </div>

                    <div style={{ padding: '20px' }}>
                        <div style={{
                            fontSize: '12px',
                            color: game.color,
                            fontWeight: '700',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            marginBottom: '8px'
                        }}>
                            {game.category}
                        </div>
                        <h3 style={{
                            fontSize: '20px',
                            fontWeight: '700',
                            margin: 0
                        }}>
                            {game.title}
                        </h3>
                    </div>
                </div>
            );
        }

        function ProfileSection({ user }) {
            return (
                <div style={{
                    background: 'var(--bg-secondary)',
                    border: '1px solid var(--border-color)',
                    borderRadius: '20px',
                    padding: '40px',
                    maxWidth: '800px'
                }}>
                    <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '30px',
                        marginBottom: '40px'
                    }}>
                        <img
                            src={user.photoURL}
                            alt={user.displayName}
                            style={{
                                width: '120px',
                                height: '120px',
                                borderRadius: '24px',
                                border: '3px solid var(--accent-primary)',
                                boxShadow: 'var(--shadow-glow)'
                            }}
                        />
                        <div style={{ flex: 1 }}>
                            <h2 style={{
                                fontSize: '32px',
                                fontWeight: '800',
                                marginBottom: '8px'
                            }}>
                                {user.displayName}
                            </h2>
                            <p style={{
                                color: 'var(--text-secondary)',
                                fontSize: '16px',
                                marginBottom: '20px'
                            }}>
                                {user.email}
                            </p>
                            <div style={{
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '8px',
                                background: 'rgba(0, 255, 136, 0.1)',
                                border: '1px solid var(--accent-primary)',
                                padding: '8px 16px',
                                borderRadius: '20px',
                                fontSize: '14px',
                                fontWeight: '600',
                                color: 'var(--accent-primary)'
                            }}>
                                <span style={{
                                    width: '8px',
                                    height: '8px',
                                    background: 'var(--accent-primary)',
                                    borderRadius: '50%',
                                    animation: 'pulse 2s ease-in-out infinite'
                                }} />
                                {user.uid.startsWith('test-user-') ? 'Test Mode' : 'Online'}
                            </div>
                        </div>
                    </div>

                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                        gap: '20px'
                    }}>
                        {[
                            { label: 'Games Played', value: '0', icon: 'üéÆ', color: 'var(--accent-primary)' },
                            { label: 'Friends', value: '0', icon: 'üë•', color: 'var(--accent-secondary)' },
                            { label: 'Total Hours', value: '0', icon: '‚è±Ô∏è', color: '#ffaa00' },
                            { label: 'Achievements', value: '0', icon: 'üèÜ', color: '#ff6b9d' }
                        ].map((stat, index) => (
                            <div
                                key={index}
                                style={{
                                    background: 'var(--bg-tertiary)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '16px',
                                    padding: '24px',
                                    textAlign: 'center',
                                    transition: 'all 0.3s ease'
                                }}
                            >
                                <div style={{ fontSize: '32px', marginBottom: '12px' }}>{stat.icon}</div>
                                <div style={{
                                    fontSize: '36px',
                                    fontWeight: '800',
                                    color: stat.color,
                                    marginBottom: '8px'
                                }}>
                                    {stat.value}
                                </div>
                                <div style={{
                                    fontSize: '14px',
                                    color: 'var(--text-secondary)',
                                    textTransform: 'uppercase',
                                    letterSpacing: '1px',
                                    fontWeight: '600'
                                }}>
                                    {stat.label}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function MessagesSection({ user }) {
            return (
                <div style={{
                    background: 'var(--bg-secondary)',
                    border: '1px solid var(--border-color)',
                    borderRadius: '20px',
                    padding: '40px',
                    textAlign: 'center',
                    maxWidth: '600px',
                    margin: '0 auto'
                }}>
                    <div style={{ fontSize: '64px', marginBottom: '20px' }}>üí¨</div>
                    <h3 style={{ fontSize: '24px', marginBottom: '12px' }}>Messages</h3>
                    <p style={{ color: 'var(--text-secondary)', marginBottom: '30px' }}>
                        Chat functionality will be available soon
                    </p>
                    <div style={{
                        background: 'var(--bg-tertiary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '12px',
                        padding: '20px',
                        marginTop: '20px'
                    }}>
                        <p style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>
                            <strong>Note:</strong> Real-time chat requires full Firebase/Supabase setup
                        </p>
                    </div>
                </div>
            );
        }

        function FavoritesSection({ games, onPlayGame }) {
            return (
                <div>
                    {games.length === 0 ? (
                        <div style={{
                            textAlign: 'center',
                            padding: '80px 20px',
                            color: 'var(--text-secondary)'
                        }}>
                            <div style={{ fontSize: '64px', marginBottom: '20px' }}>‚≠ê</div>
                            <h3 style={{ fontSize: '24px', marginBottom: '12px' }}>No favorites yet</h3>
                            <p>Star games to add them to your favorites</p>
                        </div>
                    ) : (
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
                            gap: '24px'
                        }}>
                            {games.map((game, index) => (
                                <GameCard 
                                    key={game.id} 
                                    game={game} 
                                    onPlay={onPlayGame}
                                    delay={index * 0.05}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function GamePlayer({ game, onExit }) {
            const [isFullscreen, setIsFullscreen] = useState(false);

            const toggleFullscreen = () => {
                const elem = document.getElementById('game-player');
                if (!document.fullscreenElement) {
                    elem.requestFullscreen();
                    setIsFullscreen(true);
                } else {
                    document.exitFullscreen();
                    setIsFullscreen(false);
                }
            };

            return (
                <div id="game-player" style={{
                    position: 'fixed',
                    inset: 0,
                    background: '#000',
                    display: 'flex',
                    flexDirection: 'column',
                    zIndex: 9999
                }}>
                    <div style={{
                        background: 'rgba(0, 0, 0, 0.95)',
                        padding: '16px 24px',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        borderBottom: '1px solid var(--border-color)'
                    }}>
                        <h2 style={{
                            fontSize: '20px',
                            fontWeight: '700',
                            margin: 0,
                            fontFamily: 'Space Mono, monospace'
                        }}>
                            {game.title}
                        </h2>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={toggleFullscreen}
                                style={{
                                    padding: '10px 20px',
                                    background: 'rgba(0, 255, 136, 0.2)',
                                    border: '1px solid var(--accent-primary)',
                                    borderRadius: '8px',
                                    color: 'var(--accent-primary)',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                }}
                            >
                                {isFullscreen ? '‚õ∂ Exit Fullscreen' : '‚õ∂ Fullscreen'}
                            </button>

                            <button
                                onClick={onExit}
                                style={{
                                    padding: '10px 20px',
                                    background: 'rgba(255, 68, 102, 0.2)',
                                    border: '1px solid var(--accent-danger)',
                                    borderRadius: '8px',
                                    color: 'var(--accent-danger)',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                }}
                            >
                                ‚úï Exit Game
                            </button>
                        </div>
                    </div>

                    <div style={{ flex: 1 }}>
                        <iframe
                            src={game.url}
                            style={{
                                width: '100%',
                                height: '100%',
                                border: 'none'
                            }}
                            allowFullScreen
                            allow="autoplay; fullscreen"
                            title={game.title}
                        />
                    </div>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
