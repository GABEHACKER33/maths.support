<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maths Support - Gaming Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a28;
            --accent-primary: #00ff88;
            --accent-secondary: #00ccff;
            --accent-danger: #ff4466;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-glow: 0 0 40px rgba(0, 255, 136, 0.15);
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 136, 0.03), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 204, 255, 0.03), transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        #root {
            position: relative;
            z-index: 1;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Mock Authentication Service
        const AuthService = {
            currentUser: null,
            
            signInWithGoogle: async () => {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const mockUser = {
                            uid: 'user_' + Date.now(),
                            email: 'student@kcpupils.org',
                            displayName: 'Alex Johnson',
                            photoURL: `https://api.dicebear.com/7.x/avataaars/svg?seed=${Date.now()}`,
                            stats: {
                                gamesPlayed: 47,
                                totalTime: 23,
                                achievements: 12
                            }
                        };
                        AuthService.currentUser = mockUser;
                        localStorage.setItem('mathsUser', JSON.stringify(mockUser));
                        resolve(mockUser);
                    }, 1500);
                });
            },

            signOut: () => {
                AuthService.currentUser = null;
                localStorage.removeItem('mathsUser');
            },

            getCurrentUser: () => {
                const stored = localStorage.getItem('mathsUser');
                if (stored) {
                    AuthService.currentUser = JSON.parse(stored);
                    return AuthService.currentUser;
                }
                return null;
            }
        };

        // Mock Database Service
        const DatabaseService = {
            getFriends: async (userId) => {
                return [
                    { id: '1', name: 'Sarah Chen', email: 'sarah.chen@kcpupils.org', status: 'online', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah', currentGame: 'Drive Mad' },
                    { id: '2', name: 'Marcus Brown', email: 'marcus.brown@kcpupils.org', status: 'online', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Marcus', currentGame: 'Subway Surfers' },
                    { id: '3', name: 'Emma Wilson', email: 'emma.wilson@kcpupils.org', status: 'offline', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Emma', currentGame: null },
                    { id: '4', name: 'James Lee', email: 'james.lee@kcpupils.org', status: 'online', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=James', currentGame: 'Tetris' },
                ];
            },

            getConversations: async (userId) => {
                return [
                    { 
                        id: '1', 
                        friendId: '1',
                        friendName: 'Sarah Chen', 
                        friendAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                        lastMessage: 'Want to play Drive Mad?',
                        timestamp: new Date(Date.now() - 300000),
                        unread: 2
                    },
                    { 
                        id: '2', 
                        friendId: '2',
                        friendName: 'Marcus Brown', 
                        friendAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Marcus',
                        lastMessage: 'GG! That was intense',
                        timestamp: new Date(Date.now() - 3600000),
                        unread: 0
                    }
                ];
            },

            getMessages: async (conversationId) => {
                const mockMessages = {
                    '1': [
                        { id: '1', senderId: '1', text: 'Hey! Are you free?', timestamp: new Date(Date.now() - 600000) },
                        { id: '2', senderId: 'me', text: 'Yeah! What\'s up?', timestamp: new Date(Date.now() - 540000) },
                        { id: '3', senderId: '1', text: 'Want to play Drive Mad?', timestamp: new Date(Date.now() - 300000), gameInvite: { name: 'Drive Mad', url: 'https://games.playtropolis.com/drive-mad-v2/' } },
                    ],
                    '2': [
                        { id: '1', senderId: '2', text: 'That race was crazy!', timestamp: new Date(Date.now() - 7200000) },
                        { id: '2', senderId: 'me', text: 'I know right! You almost had me', timestamp: new Date(Date.now() - 7000000) },
                        { id: '3', senderId: '2', text: 'GG! That was intense', timestamp: new Date(Date.now() - 3600000) },
                    ]
                };
                return mockMessages[conversationId] || [];
            },

            sendMessage: async (conversationId, message) => {
                return { id: Date.now().toString(), ...message, timestamp: new Date() };
            },

            addFriend: async (email) => {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({ 
                            id: Date.now().toString(), 
                            name: email.split('@')[0], 
                            email, 
                            status: 'offline', 
                            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${email}`,
                            currentGame: null
                        });
                    }, 1000);
                });
            }
        };

        // Games Data
        const GAMES = [
            { id: '1', title: 'Drive Mad', category: 'Racing', url: 'https://games.playtropolis.com/drive-mad-v2/', thumbnail: 'https://images.unsplash.com/photo-1511919884226-fd3cad34687c?w=400&h=300&fit=crop', color: '#ff4466' },
            { id: '2', title: 'Subway Surfers', category: 'Endless Runner', url: 'https://poki.com/en/g/subway-surfers', thumbnail: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop', color: '#00ccff' },
            { id: '3', title: 'Tetris', category: 'Puzzle', url: 'https://tetris.com/play-tetris', thumbnail: 'https://images.unsplash.com/photo-1607853202273-797f1c22a38e?w=400&h=300&fit=crop', color: '#00ff88' },
            { id: '4', title: 'Snake', category: 'Arcade', url: 'https://playsnake.org/', thumbnail: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=400&h=300&fit=crop', color: '#ffaa00' },
            { id: '5', title: 'Chess', category: 'Strategy', url: 'https://www.chess.com/play/computer', thumbnail: 'https://images.unsplash.com/photo-1529699211952-734e80c4d42b?w=400&h=300&fit=crop', color: '#8844ff' },
            { id: '6', title: '2048', category: 'Puzzle', url: 'https://play2048.co/', thumbnail: 'https://images.unsplash.com/photo-1611996575749-79a3a250f948?w=400&h=300&fit=crop', color: '#ff6b9d' },
            { id: '7', title: 'Minesweeper', category: 'Logic', url: 'https://minesweeper.online/', thumbnail: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=400&h=300&fit=crop', color: '#66ddff' },
            { id: '8', title: 'Pac-Man', category: 'Arcade', url: 'https://www.google.com/logos/2010/pacman10-i.html', thumbnail: 'https://images.unsplash.com/photo-1578303512597-81e6cc155b3e?w=400&h=300&fit=crop', color: '#ffdd00' },
        ];

        // Login Screen Component
        function LoginScreen({ onLoginSuccess }) {
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleGoogleSignIn = async () => {
                setLoading(true);
                setError('');
                try {
                    const user = await AuthService.signInWithGoogle();
                    onLoginSuccess(user);
                } catch (err) {
                    setError('Failed to sign in. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    inset: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'var(--bg-primary)',
                    animation: 'fadeIn 0.6s ease-out'
                }}>
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '24px',
                        padding: '60px 50px',
                        maxWidth: '440px',
                        width: '90%',
                        textAlign: 'center',
                        boxShadow: 'var(--shadow-glow)'
                    }}>
                        {/* Logo */}
                        <div style={{
                            width: '80px',
                            height: '80px',
                            margin: '0 auto 30px',
                            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                            borderRadius: '20px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: '40px',
                            animation: 'float 3s ease-in-out infinite'
                        }}>
                            üéÆ
                        </div>

                        <h1 style={{
                            fontSize: '32px',
                            fontWeight: '800',
                            marginBottom: '12px',
                            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            backgroundClip: 'text'
                        }}>
                            Maths Support
                        </h1>

                        <p style={{
                            color: 'var(--text-secondary)',
                            marginBottom: '40px',
                            fontSize: '15px'
                        }}>
                            Sign in with your @kcpupils.org account to access games, chat with friends, and track your progress
                        </p>

                        <button
                            onClick={handleGoogleSignIn}
                            disabled={loading}
                            style={{
                                width: '100%',
                                padding: '16px',
                                background: '#fff',
                                color: '#000',
                                border: 'none',
                                borderRadius: '12px',
                                fontSize: '16px',
                                fontWeight: '700',
                                cursor: loading ? 'not-allowed' : 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '12px',
                                transition: 'all 0.3s ease',
                                opacity: loading ? 0.6 : 1
                            }}
                            onMouseEnter={(e) => {
                                if (!loading) {
                                    e.target.style.transform = 'translateY(-2px)';
                                    e.target.style.boxShadow = '0 8px 24px rgba(255,255,255,0.2)';
                                }
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.transform = 'translateY(0)';
                                e.target.style.boxShadow = 'none';
                            }}
                        >
                            {loading ? (
                                <>
                                    <div style={{ 
                                        width: '20px', 
                                        height: '20px', 
                                        border: '3px solid #ddd', 
                                        borderTop: '3px solid #000',
                                        borderRadius: '50%',
                                        animation: 'spin 1s linear infinite'
                                    }} />
                                    <span>Signing in...</span>
                                </>
                            ) : (
                                <>
                                    <svg width="20" height="20" viewBox="0 0 24 24">
                                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                    <span>Continue with Google</span>
                                </>
                            )}
                        </button>

                        {error && (
                            <div style={{
                                marginTop: '20px',
                                padding: '12px',
                                background: 'rgba(255, 68, 102, 0.1)',
                                border: '1px solid var(--accent-danger)',
                                borderRadius: '8px',
                                color: 'var(--accent-danger)',
                                fontSize: '14px'
                            }}>
                                {error}
                            </div>
                        )}

                        <div style={{
                            marginTop: '30px',
                            fontSize: '13px',
                            color: 'var(--text-secondary)',
                            lineHeight: '1.6'
                        }}>
                            By signing in, you agree to our Terms of Service and Privacy Policy
                        </div>
                    </div>

                    <style>{`
                        @keyframes float {
                            0%, 100% { transform: translateY(0); }
                            50% { transform: translateY(-10px); }
                        }
                        @keyframes spin {
                            to { transform: rotate(360deg); }
                        }
                    `}</style>
                </div>
            );
        }

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [activeSection, setActiveSection] = useState('games');
            const [friends, setFriends] = useState([]);
            const [conversations, setConversations] = useState([]);
            const [activeConversation, setActiveConversation] = useState(null);
            const [messages, setMessages] = useState([]);
            const [currentGame, setCurrentGame] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [showAddFriend, setShowAddFriend] = useState(false);
            const [showGameInvite, setShowGameInvite] = useState(false);
            const [selectedFriend, setSelectedFriend] = useState(null);

            useEffect(() => {
                const existingUser = AuthService.getCurrentUser();
                if (existingUser) {
                    setUser(existingUser);
                    loadUserData(existingUser);
                }
            }, []);

            const loadUserData = async (user) => {
                const friendsList = await DatabaseService.getFriends(user.uid);
                setFriends(friendsList);

                const convos = await DatabaseService.getConversations(user.uid);
                setConversations(convos);
            };

            const handleLogin = (loggedInUser) => {
                setUser(loggedInUser);
                loadUserData(loggedInUser);
            };

            const handleLogout = () => {
                AuthService.signOut();
                setUser(null);
                setActiveSection('games');
                setFriends([]);
                setConversations([]);
            };

            const openConversation = async (conversation) => {
                setActiveConversation(conversation);
                const msgs = await DatabaseService.getMessages(conversation.id);
                setMessages(msgs);
            };

            const sendMessage = async (text, gameInvite = null) => {
                if (!text.trim() && !gameInvite) return;

                const newMessage = {
                    senderId: 'me',
                    text,
                    gameInvite
                };

                const sentMessage = await DatabaseService.sendMessage(activeConversation.id, newMessage);
                setMessages([...messages, sentMessage]);
            };

            const playGame = (game) => {
                setCurrentGame(game);
            };

            const exitGame = () => {
                setCurrentGame(null);
            };

            const filteredGames = GAMES.filter(game => 
                game.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                game.category.toLowerCase().includes(searchQuery.toLowerCase())
            );

            if (!user) {
                return <LoginScreen onLoginSuccess={handleLogin} />;
            }

            if (currentGame) {
                return <GamePlayer game={currentGame} onExit={exitGame} />;
            }

            return (
                <div style={{ display: 'flex', height: '100vh' }}>
                    {/* Sidebar Navigation */}
                    <Sidebar 
                        activeSection={activeSection}
                        onSectionChange={setActiveSection}
                        onLogout={handleLogout}
                    />

                    {/* Main Content */}
                    <MainContent
                        activeSection={activeSection}
                        user={user}
                        friends={friends}
                        conversations={conversations}
                        activeConversation={activeConversation}
                        messages={messages}
                        games={filteredGames}
                        searchQuery={searchQuery}
                        onSearchChange={setSearchQuery}
                        onPlayGame={playGame}
                        onOpenConversation={openConversation}
                        onSendMessage={sendMessage}
                        onShowAddFriend={() => setShowAddFriend(true)}
                        onShowGameInvite={(friend) => {
                            setSelectedFriend(friend);
                            setShowGameInvite(true);
                        }}
                    />

                    {/* Friends Panel */}
                    <FriendsPanel 
                        friends={friends}
                        onMessageFriend={(friend) => {
                            const conv = conversations.find(c => c.friendId === friend.id) || {
                                id: friend.id,
                                friendId: friend.id,
                                friendName: friend.name,
                                friendAvatar: friend.avatar,
                                lastMessage: '',
                                timestamp: new Date(),
                                unread: 0
                            };
                            openConversation(conv);
                            setActiveSection('messages');
                        }}
                        onAddFriend={() => setShowAddFriend(true)}
                    />

                    {/* Modals */}
                    {showAddFriend && (
                        <AddFriendModal
                            onClose={() => setShowAddFriend(false)}
                            onAddFriend={async (email) => {
                                const newFriend = await DatabaseService.addFriend(email);
                                setFriends([...friends, newFriend]);
                                setShowAddFriend(false);
                            }}
                        />
                    )}

                    {showGameInvite && (
                        <GameInviteModal
                            games={GAMES}
                            friend={selectedFriend}
                            onClose={() => setShowGameInvite(false)}
                            onInvite={(game) => {
                                sendMessage(`Let's play ${game.title}!`, game);
                                setShowGameInvite(false);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ activeSection, onSectionChange, onLogout }) {
            const sections = [
                { id: 'games', icon: 'üéÆ', label: 'Games' },
                { id: 'profile', icon: 'üë§', label: 'Profile' },
                { id: 'messages', icon: 'üí¨', label: 'Messages' },
                { id: 'favorites', icon: '‚≠ê', label: 'Favorites' }
            ];

            return (
                <div style={{
                    width: '80px',
                    background: 'var(--bg-secondary)',
                    borderRight: '1px solid var(--border-color)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    padding: '20px 0',
                    gap: '10px'
                }}>
                    {/* Logo */}
                    <div style={{
                        width: '48px',
                        height: '48px',
                        background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                        borderRadius: '12px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '24px',
                        marginBottom: '20px'
                    }}>
                        üéÆ
                    </div>

                    {/* Navigation Items */}
                    {sections.map(section => (
                        <button
                            key={section.id}
                            onClick={() => onSectionChange(section.id)}
                            style={{
                                width: '56px',
                                height: '56px',
                                background: activeSection === section.id ? 'rgba(0, 255, 136, 0.1)' : 'transparent',
                                border: activeSection === section.id ? '1px solid var(--accent-primary)' : '1px solid transparent',
                                borderRadius: '14px',
                                color: activeSection === section.id ? 'var(--accent-primary)' : 'var(--text-secondary)',
                                fontSize: '24px',
                                cursor: 'pointer',
                                transition: 'all 0.3s ease',
                                position: 'relative'
                            }}
                            onMouseEnter={(e) => {
                                if (activeSection !== section.id) {
                                    e.target.style.background = 'rgba(255, 255, 255, 0.05)';
                                    e.target.style.transform = 'translateY(-2px)';
                                }
                            }}
                            onMouseLeave={(e) => {
                                if (activeSection !== section.id) {
                                    e.target.style.background = 'transparent';
                                    e.target.style.transform = 'translateY(0)';
                                }
                            }}
                            title={section.label}
                        >
                            {section.icon}
                        </button>
                    ))}

                    {/* Spacer */}
                    <div style={{ flex: 1 }} />

                    {/* Logout */}
                    <button
                        onClick={onLogout}
                        style={{
                            width: '56px',
                            height: '56px',
                            background: 'transparent',
                            border: '1px solid transparent',
                            borderRadius: '14px',
                            color: 'var(--accent-danger)',
                            fontSize: '24px',
                            cursor: 'pointer',
                            transition: 'all 0.3s ease'
                        }}
                        onMouseEnter={(e) => {
                            e.target.style.background = 'rgba(255, 68, 102, 0.1)';
                            e.target.style.borderColor = 'var(--accent-danger)';
                        }}
                        onMouseLeave={(e) => {
                            e.target.style.background = 'transparent';
                            e.target.style.borderColor = 'transparent';
                        }}
                        title="Logout"
                    >
                        üö™
                    </button>
                </div>
            );
        }

        // Main Content Component
        function MainContent({ 
            activeSection, user, friends, conversations, activeConversation, messages,
            games, searchQuery, onSearchChange, onPlayGame, onOpenConversation, 
            onSendMessage, onShowAddFriend, onShowGameInvite 
        }) {
            return (
                <div style={{ flex: 1, overflow: 'auto', padding: '40px' }}>
                    {activeSection === 'games' && (
                        <GamesSection 
                            games={games}
                            searchQuery={searchQuery}
                            onSearchChange={onSearchChange}
                            onPlayGame={onPlayGame}
                        />
                    )}

                    {activeSection === 'profile' && (
                        <ProfileSection user={user} friends={friends} />
                    )}

                    {activeSection === 'messages' && (
                        <MessagesSection
                            conversations={conversations}
                            activeConversation={activeConversation}
                            messages={messages}
                            onOpenConversation={onOpenConversation}
                            onSendMessage={onSendMessage}
                            onShowGameInvite={onShowGameInvite}
                        />
                    )}

                    {activeSection === 'favorites' && (
                        <FavoritesSection games={games.slice(0, 3)} onPlayGame={onPlayGame} />
                    )}
                </div>
            );
        }

        // Games Section
        function GamesSection({ games, searchQuery, onSearchChange, onPlayGame }) {
            return (
                <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '40px'
                    }}>
                        <h1 style={{
                            fontSize: '36px',
                            fontWeight: '800',
                            background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            backgroundClip: 'text'
                        }}>
                            Game Library
                        </h1>

                        <input
                            type="text"
                            value={searchQuery}
                            onChange={(e) => onSearchChange(e.target.value)}
                            placeholder="Search games..."
                            style={{
                                padding: '12px 20px',
                                background: 'var(--bg-secondary)',
                                border: '1px solid var(--border-color)',
                                borderRadius: '12px',
                                color: 'var(--text-primary)',
                                fontSize: '15px',
                                width: '300px',
                                outline: 'none',
                                transition: 'all 0.3s ease'
                            }}
                            onFocus={(e) => {
                                e.target.style.borderColor = 'var(--accent-primary)';
                                e.target.style.background = 'var(--bg-tertiary)';
                            }}
                            onBlur={(e) => {
                                e.target.style.borderColor = 'var(--border-color)';
                                e.target.style.background = 'var(--bg-secondary)';
                            }}
                        />
                    </div>

                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
                        gap: '24px'
                    }}>
                        {games.map((game, index) => (
                            <GameCard 
                                key={game.id} 
                                game={game} 
                                onPlay={onPlayGame}
                                delay={index * 0.05}
                            />
                        ))}
                    </div>
                </div>
            );
        }

        // Game Card Component
        function GameCard({ game, onPlay, delay }) {
            return (
                <div
                    onClick={() => onPlay(game)}
                    style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '16px',
                        overflow: 'hidden',
                        cursor: 'pointer',
                        transition: 'all 0.4s ease',
                        animation: `fadeIn 0.5s ease-out ${delay}s both`,
                        position: 'relative'
                    }}
                    onMouseEnter={(e) => {
                        e.currentTarget.style.transform = 'translateY(-8px)';
                        e.currentTarget.style.borderColor = game.color;
                        e.currentTarget.style.boxShadow = `0 20px 40px ${game.color}40`;
                    }}
                    onMouseLeave={(e) => {
                        e.currentTarget.style.transform = 'translateY(0)';
                        e.currentTarget.style.borderColor = 'var(--border-color)';
                        e.currentTarget.style.boxShadow = 'none';
                    }}
                >
                    <div style={{
                        height: '180px',
                        background: `linear-gradient(135deg, ${game.color}40, ${game.color}20)`,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '64px',
                        position: 'relative',
                        overflow: 'hidden'
                    }}>
                        <img 
                            src={game.thumbnail} 
                            alt={game.title}
                            style={{
                                width: '100%',
                                height: '100%',
                                objectFit: 'cover',
                                opacity: 0.6,
                                transition: 'all 0.4s ease'
                            }}
                            onMouseEnter={(e) => {
                                e.target.style.transform = 'scale(1.1)';
                                e.target.style.opacity = '0.8';
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.transform = 'scale(1)';
                                e.target.style.opacity = '0.6';
                            }}
                        />
                        <div style={{
                            position: 'absolute',
                            inset: 0,
                            background: `linear-gradient(to top, ${game.color}60, transparent)`
                        }} />
                    </div>

                    <div style={{ padding: '20px' }}>
                        <div style={{
                            fontSize: '12px',
                            color: game.color,
                            fontWeight: '700',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            marginBottom: '8px'
                        }}>
                            {game.category}
                        </div>
                        <h3 style={{
                            fontSize: '20px',
                            fontWeight: '700',
                            margin: 0
                        }}>
                            {game.title}
                        </h3>
                    </div>

                    <div style={{
                        position: 'absolute',
                        top: '12px',
                        right: '12px',
                        background: 'rgba(0, 0, 0, 0.6)',
                        backdropFilter: 'blur(10px)',
                        padding: '8px 12px',
                        borderRadius: '8px',
                        fontSize: '12px',
                        fontWeight: '600',
                        color: 'var(--accent-primary)'
                    }}>
                        Play Now
                    </div>
                </div>
            );
        }

        // Profile Section
        function ProfileSection({ user, friends }) {
            return (
                <div style={{ animation: 'fadeIn 0.5s ease-out', maxWidth: '1000px', margin: '0 auto' }}>
                    {/* Profile Header */}
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '20px',
                        padding: '40px',
                        marginBottom: '30px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '30px'
                    }}>
                        <img
                            src={user.photoURL}
                            alt={user.displayName}
                            style={{
                                width: '120px',
                                height: '120px',
                                borderRadius: '24px',
                                border: '3px solid var(--accent-primary)',
                                boxShadow: 'var(--shadow-glow)'
                            }}
                        />
                        <div style={{ flex: 1 }}>
                            <h2 style={{
                                fontSize: '32px',
                                fontWeight: '800',
                                marginBottom: '8px'
                            }}>
                                {user.displayName}
                            </h2>
                            <p style={{
                                color: 'var(--text-secondary)',
                                fontSize: '16px',
                                marginBottom: '20px'
                            }}>
                                {user.email}
                            </p>
                            <div style={{
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '8px',
                                background: 'rgba(0, 255, 136, 0.1)',
                                border: '1px solid var(--accent-primary)',
                                padding: '8px 16px',
                                borderRadius: '20px',
                                fontSize: '14px',
                                fontWeight: '600',
                                color: 'var(--accent-primary)'
                            }}>
                                <span style={{
                                    width: '8px',
                                    height: '8px',
                                    background: 'var(--accent-primary)',
                                    borderRadius: '50%',
                                    animation: 'pulse 2s ease-in-out infinite'
                                }} />
                                Online
                            </div>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                        gap: '20px',
                        marginBottom: '30px'
                    }}>
                        {[
                            { label: 'Games Played', value: user.stats.gamesPlayed, icon: 'üéÆ', color: 'var(--accent-primary)' },
                            { label: 'Friends', value: friends.length, icon: 'üë•', color: 'var(--accent-secondary)' },
                            { label: 'Total Hours', value: user.stats.totalTime, icon: '‚è±Ô∏è', color: '#ffaa00' },
                            { label: 'Achievements', value: user.stats.achievements, icon: 'üèÜ', color: '#ff6b9d' }
                        ].map((stat, index) => (
                            <div
                                key={index}
                                style={{
                                    background: 'var(--bg-secondary)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '16px',
                                    padding: '24px',
                                    textAlign: 'center',
                                    transition: 'all 0.3s ease',
                                    animation: `fadeIn 0.5s ease-out ${index * 0.1}s both`
                                }}
                                onMouseEnter={(e) => {
                                    e.currentTarget.style.borderColor = stat.color;
                                    e.currentTarget.style.transform = 'translateY(-4px)';
                                }}
                                onMouseLeave={(e) => {
                                    e.currentTarget.style.borderColor = 'var(--border-color)';
                                    e.currentTarget.style.transform = 'translateY(0)';
                                }}
                            >
                                <div style={{ fontSize: '32px', marginBottom: '12px' }}>{stat.icon}</div>
                                <div style={{
                                    fontSize: '36px',
                                    fontWeight: '800',
                                    color: stat.color,
                                    marginBottom: '8px'
                                }}>
                                    {stat.value}
                                </div>
                                <div style={{
                                    fontSize: '14px',
                                    color: 'var(--text-secondary)',
                                    textTransform: 'uppercase',
                                    letterSpacing: '1px',
                                    fontWeight: '600'
                                }}>
                                    {stat.label}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Recent Activity */}
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '16px',
                        padding: '24px'
                    }}>
                        <h3 style={{
                            fontSize: '20px',
                            fontWeight: '700',
                            marginBottom: '20px'
                        }}>
                            Recent Activity
                        </h3>
                        <div style={{ color: 'var(--text-secondary)' }}>
                            <p>‚Ä¢ Played Drive Mad - 2 hours ago</p>
                            <p>‚Ä¢ Added Marcus Brown as friend - 5 hours ago</p>
                            <p>‚Ä¢ Completed achievement "Speed Demon" - Yesterday</p>
                        </div>
                    </div>
                </div>
            );
        }

        // Messages Section
        function MessagesSection({ conversations, activeConversation, messages, onOpenConversation, onSendMessage, onShowGameInvite }) {
            const [messageText, setMessageText] = useState('');

            const handleSend = () => {
                if (messageText.trim()) {
                    onSendMessage(messageText);
                    setMessageText('');
                }
            };

            return (
                <div style={{
                    display: 'grid',
                    gridTemplateColumns: '320px 1fr',
                    gap: '24px',
                    height: 'calc(100vh - 80px)',
                    animation: 'fadeIn 0.5s ease-out'
                }}>
                    {/* Conversations List */}
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '16px',
                        overflow: 'hidden',
                        display: 'flex',
                        flexDirection: 'column'
                    }}>
                        <div style={{
                            padding: '20px',
                            borderBottom: '1px solid var(--border-color)'
                        }}>
                            <h2 style={{
                                fontSize: '20px',
                                fontWeight: '700',
                                margin: 0
                            }}>
                                Messages
                            </h2>
                        </div>

                        <div style={{ flex: 1, overflow: 'auto' }}>
                            {conversations.length === 0 ? (
                                <div style={{
                                    padding: '40px 20px',
                                    textAlign: 'center',
                                    color: 'var(--text-secondary)'
                                }}>
                                    <div style={{ fontSize: '48px', marginBottom: '16px' }}>üí¨</div>
                                    <div>No messages yet</div>
                                </div>
                            ) : (
                                conversations.map(conv => (
                                    <div
                                        key={conv.id}
                                        onClick={() => onOpenConversation(conv)}
                                        style={{
                                            padding: '16px 20px',
                                            borderBottom: '1px solid var(--border-color)',
                                            cursor: 'pointer',
                                            background: activeConversation?.id === conv.id ? 'rgba(0, 255, 136, 0.05)' : 'transparent',
                                            transition: 'all 0.2s ease',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '12px'
                                        }}
                                        onMouseEnter={(e) => {
                                            if (activeConversation?.id !== conv.id) {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.03)';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (activeConversation?.id !== conv.id) {
                                                e.currentTarget.style.background = 'transparent';
                                            }
                                        }}
                                    >
                                        <img
                                            src={conv.friendAvatar}
                                            alt={conv.friendName}
                                            style={{
                                                width: '48px',
                                                height: '48px',
                                                borderRadius: '12px'
                                            }}
                                        />
                                        <div style={{ flex: 1, minWidth: 0 }}>
                                            <div style={{
                                                fontWeight: '600',
                                                marginBottom: '4px',
                                                whiteSpace: 'nowrap',
                                                overflow: 'hidden',
                                                textOverflow: 'ellipsis'
                                            }}>
                                                {conv.friendName}
                                            </div>
                                            <div style={{
                                                fontSize: '13px',
                                                color: 'var(--text-secondary)',
                                                whiteSpace: 'nowrap',
                                                overflow: 'hidden',
                                                textOverflow: 'ellipsis'
                                            }}>
                                                {conv.lastMessage}
                                            </div>
                                        </div>
                                        {conv.unread > 0 && (
                                            <div style={{
                                                background: 'var(--accent-primary)',
                                                color: '#000',
                                                fontSize: '11px',
                                                fontWeight: '700',
                                                padding: '4px 8px',
                                                borderRadius: '12px',
                                                minWidth: '20px',
                                                textAlign: 'center'
                                            }}>
                                                {conv.unread}
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    {/* Chat Area */}
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '1px solid var(--border-color)',
                        borderRadius: '16px',
                        overflow: 'hidden',
                        display: 'flex',
                        flexDirection: 'column'
                    }}>
                        {activeConversation ? (
                            <>
                                {/* Chat Header */}
                                <div style={{
                                    padding: '20px',
                                    borderBottom: '1px solid var(--border-color)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '12px'
                                }}>
                                    <img
                                        src={activeConversation.friendAvatar}
                                        alt={activeConversation.friendName}
                                        style={{
                                            width: '48px',
                                            height: '48px',
                                            borderRadius: '12px'
                                        }}
                                    />
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: '700', fontSize: '18px' }}>
                                            {activeConversation.friendName}
                                        </div>
                                        <div style={{ fontSize: '13px', color: 'var(--accent-primary)' }}>
                                            Online
                                        </div>
                                    </div>
                                </div>

                                {/* Messages */}
                                <div style={{
                                    flex: 1,
                                    padding: '20px',
                                    overflow: 'auto',
                                    display: 'flex',
                                    flexDirection: 'column',
                                    gap: '16px'
                                }}>
                                    {messages.map(msg => (
                                        <div
                                            key={msg.id}
                                            style={{
                                                display: 'flex',
                                                gap: '12px',
                                                alignSelf: msg.senderId === 'me' ? 'flex-end' : 'flex-start',
                                                maxWidth: '70%',
                                                flexDirection: msg.senderId === 'me' ? 'row-reverse' : 'row'
                                            }}
                                        >
                                            <img
                                                src={msg.senderId === 'me' 
                                                    ? AuthService.currentUser.photoURL 
                                                    : activeConversation.friendAvatar}
                                                alt="Avatar"
                                                style={{
                                                    width: '36px',
                                                    height: '36px',
                                                    borderRadius: '10px'
                                                }}
                                            />
                                            <div>
                                                <div style={{
                                                    background: msg.senderId === 'me' 
                                                        ? 'var(--accent-primary)' 
                                                        : 'var(--bg-tertiary)',
                                                    color: msg.senderId === 'me' ? '#000' : 'var(--text-primary)',
                                                    padding: '12px 16px',
                                                    borderRadius: '12px',
                                                    fontSize: '15px',
                                                    lineHeight: '1.5'
                                                }}>
                                                    {msg.text}
                                                </div>
                                                {msg.gameInvite && (
                                                    <div style={{
                                                        marginTop: '8px',
                                                        padding: '12px',
                                                        background: 'rgba(0, 255, 136, 0.1)',
                                                        border: '1px solid var(--accent-primary)',
                                                        borderRadius: '10px'
                                                    }}>
                                                        <div style={{
                                                            fontSize: '13px',
                                                            color: 'var(--accent-primary)',
                                                            fontWeight: '600',
                                                            marginBottom: '8px'
                                                        }}>
                                                            üéÆ Game Invite
                                                        </div>
                                                        <div style={{ fontSize: '14px', marginBottom: '8px' }}>
                                                            {msg.gameInvite.name}
                                                        </div>
                                                        <button style={{
                                                            background: 'var(--accent-primary)',
                                                            color: '#000',
                                                            border: 'none',
                                                            padding: '8px 16px',
                                                            borderRadius: '8px',
                                                            fontWeight: '600',
                                                            fontSize: '13px',
                                                            cursor: 'pointer'
                                                        }}>
                                                            Join Game
                                                        </button>
                                                    </div>
                                                )}
                                                <div style={{
                                                    fontSize: '11px',
                                                    color: 'var(--text-secondary)',
                                                    marginTop: '4px',
                                                    textAlign: msg.senderId === 'me' ? 'right' : 'left'
                                                }}>
                                                    {msg.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* Input Area */}
                                <div style={{
                                    padding: '20px',
                                    borderTop: '1px solid var(--border-color)',
                                    display: 'flex',
                                    gap: '12px',
                                    alignItems: 'flex-end'
                                }}>
                                    <button
                                        onClick={() => onShowGameInvite(activeConversation)}
                                        style={{
                                            width: '44px',
                                            height: '44px',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--accent-primary)',
                                            fontSize: '20px',
                                            cursor: 'pointer',
                                            transition: 'all 0.3s ease'
                                        }}
                                        onMouseEnter={(e) => {
                                            e.target.style.background = 'var(--accent-primary)';
                                            e.target.style.color = '#000';
                                        }}
                                        onMouseLeave={(e) => {
                                            e.target.style.background = 'var(--bg-tertiary)';
                                            e.target.style.color = 'var(--accent-primary)';
                                        }}
                                        title="Invite to game"
                                    >
                                        üéÆ
                                    </button>
                                    <textarea
                                        value={messageText}
                                        onChange={(e) => setMessageText(e.target.value)}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter' && !e.shiftKey) {
                                                e.preventDefault();
                                                handleSend();
                                            }
                                        }}
                                        placeholder="Type a message..."
                                        style={{
                                            flex: 1,
                                            padding: '12px 16px',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '15px',
                                            resize: 'none',
                                            fontFamily: 'Manrope, sans-serif',
                                            outline: 'none',
                                            minHeight: '44px',
                                            maxHeight: '120px'
                                        }}
                                        rows={1}
                                    />
                                    <button
                                        onClick={handleSend}
                                        style={{
                                            width: '44px',
                                            height: '44px',
                                            background: 'var(--accent-primary)',
                                            border: 'none',
                                            borderRadius: '12px',
                                            color: '#000',
                                            fontSize: '20px',
                                            cursor: 'pointer',
                                            transition: 'all 0.3s ease'
                                        }}
                                        onMouseEnter={(e) => {
                                            e.target.style.transform = 'scale(1.05)';
                                        }}
                                        onMouseLeave={(e) => {
                                            e.target.style.transform = 'scale(1)';
                                        }}
                                    >
                                        ‚û§
                                    </button>
                                </div>
                            </>
                        ) : (
                            <div style={{
                                flex: 1,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'var(--text-secondary)',
                                textAlign: 'center',
                                padding: '40px'
                            }}>
                                <div>
                                    <div style={{ fontSize: '64px', marginBottom: '20px' }}>üí¨</div>
                                    <div style={{ fontSize: '18px' }}>Select a conversation to start messaging</div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Favorites Section
        function FavoritesSection({ games, onPlayGame }) {
            return (
                <div style={{ animation: 'fadeIn 0.5s ease-out' }}>
                    <h1 style={{
                        fontSize: '36px',
                        fontWeight: '800',
                        marginBottom: '40px',
                        background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                        WebkitBackgroundClip: 'text',
                        WebkitTextFillColor: 'transparent',
                        backgroundClip: 'text'
                    }}>
                        Favorites
                    </h1>

                    {games.length === 0 ? (
                        <div style={{
                            textAlign: 'center',
                            padding: '80px 20px',
                            color: 'var(--text-secondary)'
                        }}>
                            <div style={{ fontSize: '64px', marginBottom: '20px' }}>‚≠ê</div>
                            <h3 style={{ fontSize: '24px', marginBottom: '12px' }}>No favorites yet</h3>
                            <p>Star games to add them to your favorites</p>
                        </div>
                    ) : (
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
                            gap: '24px'
                        }}>
                            {games.map((game, index) => (
                                <GameCard 
                                    key={game.id} 
                                    game={game} 
                                    onPlay={onPlayGame}
                                    delay={index * 0.05}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Friends Panel
        function FriendsPanel({ friends, onMessageFriend, onAddFriend }) {
            return (
                <div style={{
                    width: '320px',
                    background: 'var(--bg-secondary)',
                    borderLeft: '1px solid var(--border-color)',
                    padding: '20px',
                    overflow: 'auto'
                }}>
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '20px'
                    }}>
                        <h3 style={{
                            fontSize: '14px',
                            fontWeight: '700',
                            textTransform: 'uppercase',
                            letterSpacing: '1px',
                            color: 'var(--text-secondary)',
                            margin: 0
                        }}>
                            Friends ({friends.length})
                        </h3>
                        <button
                            onClick={onAddFriend}
                            style={{
                                width: '32px',
                                height: '32px',
                                background: 'var(--accent-primary)',
                                border: 'none',
                                borderRadius: '8px',
                                color: '#000',
                                fontSize: '18px',
                                cursor: 'pointer',
                                transition: 'all 0.3s ease'
                            }}
                            onMouseEnter={(e) => {
                                e.target.style.transform = 'rotate(90deg) scale(1.1)';
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.transform = 'rotate(0) scale(1)';
                            }}
                            title="Add friend"
                        >
                            +
                        </button>
                    </div>

                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        {friends.map(friend => (
                            <div
                                key={friend.id}
                                onClick={() => onMessageFriend(friend)}
                                style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '12px',
                                    padding: '12px',
                                    background: 'var(--bg-tertiary)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '12px',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease',
                                    position: 'relative'
                                }}
                                onMouseEnter={(e) => {
                                    e.currentTarget.style.background = 'rgba(0, 255, 136, 0.05)';
                                    e.currentTarget.style.borderColor = 'var(--accent-primary)';
                                    e.currentTarget.style.transform = 'translateX(-4px)';
                                }}
                                onMouseLeave={(e) => {
                                    e.currentTarget.style.background = 'var(--bg-tertiary)';
                                    e.currentTarget.style.borderColor = 'var(--border-color)';
                                    e.currentTarget.style.transform = 'translateX(0)';
                                }}
                            >
                                <div style={{ position: 'relative' }}>
                                    <img
                                        src={friend.avatar}
                                        alt={friend.name}
                                        style={{
                                            width: '40px',
                                            height: '40px',
                                            borderRadius: '10px'
                                        }}
                                    />
                                    <div style={{
                                        position: 'absolute',
                                        bottom: '-2px',
                                        right: '-2px',
                                        width: '12px',
                                        height: '12px',
                                        background: friend.status === 'online' ? 'var(--accent-primary)' : 'var(--text-secondary)',
                                        border: '2px solid var(--bg-secondary)',
                                        borderRadius: '50%'
                                    }} />
                                </div>
                                <div style={{ flex: 1, minWidth: 0 }}>
                                    <div style={{
                                        fontWeight: '600',
                                        fontSize: '14px',
                                        marginBottom: '2px',
                                        whiteSpace: 'nowrap',
                                        overflow: 'hidden',
                                        textOverflow: 'ellipsis'
                                    }}>
                                        {friend.name}
                                    </div>
                                    <div style={{
                                        fontSize: '12px',
                                        color: 'var(--text-secondary)',
                                        whiteSpace: 'nowrap',
                                        overflow: 'hidden',
                                        textOverflow: 'ellipsis'
                                    }}>
                                        {friend.currentGame || 'Offline'}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Add Friend Modal
        function AddFriendModal({ onClose, onAddFriend }) {
            const [email, setEmail] = useState('');
            const [loading, setLoading] = useState(false);

            const handleAdd = async () => {
                if (!email.trim() || !email.endsWith('@kcpupils.org')) {
                    alert('Please enter a valid @kcpupils.org email');
                    return;
                }
                setLoading(true);
                await onAddFriend(email);
                setLoading(false);
            };

            return (
                <div
                    style={{
                        position: 'fixed',
                        inset: 0,
                        background: 'rgba(0, 0, 0, 0.8)',
                        backdropFilter: 'blur(10px)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        zIndex: 1000,
                        animation: 'fadeIn 0.3s ease-out'
                    }}
                    onClick={onClose}
                >
                    <div
                        onClick={(e) => e.stopPropagation()}
                        style={{
                            background: 'var(--bg-secondary)',
                            border: '1px solid var(--border-color)',
                            borderRadius: '20px',
                            padding: '40px',
                            width: '440px',
                            maxWidth: '90%',
                            boxShadow: 'var(--shadow-glow)'
                        }}
                    >
                        <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            marginBottom: '24px'
                        }}>
                            <h2 style={{
                                fontSize: '24px',
                                fontWeight: '700',
                                margin: 0
                            }}>
                                Add Friend
                            </h2>
                            <button
                                onClick={onClose}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    color: 'var(--text-secondary)',
                                    fontSize: '24px',
                                    cursor: 'pointer',
                                    padding: 0,
                                    width: '32px',
                                    height: '32px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.color = 'var(--accent-danger)';
                                    e.target.style.transform = 'rotate(90deg)';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.color = 'var(--text-secondary)';
                                    e.target.style.transform = 'rotate(0)';
                                }}
                            >
                                √ó
                            </button>
                        </div>

                        <input
                            type="email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            placeholder="friend@kcpupils.org"
                            style={{
                                width: '100%',
                                padding: '14px 18px',
                                background: 'var(--bg-tertiary)',
                                border: '1px solid var(--border-color)',
                                borderRadius: '12px',
                                color: 'var(--text-primary)',
                                fontSize: '15px',
                                marginBottom: '20px',
                                outline: 'none',
                                transition: 'all 0.3s ease'
                            }}
                            onFocus={(e) => {
                                e.target.style.borderColor = 'var(--accent-primary)';
                            }}
                            onBlur={(e) => {
                                e.target.style.borderColor = 'var(--border-color)';
                            }}
                        />

                        <button
                            onClick={handleAdd}
                            disabled={loading}
                            style={{
                                width: '100%',
                                padding: '14px',
                                background: 'var(--accent-primary)',
                                color: '#000',
                                border: 'none',
                                borderRadius: '12px',
                                fontSize: '16px',
                                fontWeight: '700',
                                cursor: loading ? 'not-allowed' : 'pointer',
                                transition: 'all 0.3s ease',
                                opacity: loading ? 0.6 : 1
                            }}
                            onMouseEnter={(e) => {
                                if (!loading) {
                                    e.target.style.transform = 'translateY(-2px)';
                                    e.target.style.boxShadow = 'var(--shadow-glow)';
                                }
                            }}
                            onMouseLeave={(e) => {
                                e.target.style.transform = 'translateY(0)';
                                e.target.style.boxShadow = 'none';
                            }}
                        >
                            {loading ? 'Adding...' : 'Add Friend'}
                        </button>
                    </div>
                </div>
            );
        }

        // Game Invite Modal
        function GameInviteModal({ games, friend, onClose, onInvite }) {
            return (
                <div
                    style={{
                        position: 'fixed',
                        inset: 0,
                        background: 'rgba(0, 0, 0, 0.8)',
                        backdropFilter: 'blur(10px)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        zIndex: 1000,
                        animation: 'fadeIn 0.3s ease-out'
                    }}
                    onClick={onClose}
                >
                    <div
                        onClick={(e) => e.stopPropagation()}
                        style={{
                            background: 'var(--bg-secondary)',
                            border: '1px solid var(--border-color)',
                            borderRadius: '20px',
                            padding: '40px',
                            width: '500px',
                            maxWidth: '90%',
                            maxHeight: '80vh',
                            overflow: 'auto',
                            boxShadow: 'var(--shadow-glow)'
                        }}
                    >
                        <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            marginBottom: '24px'
                        }}>
                            <h2 style={{
                                fontSize: '24px',
                                fontWeight: '700',
                                margin: 0
                            }}>
                                Invite to Game
                            </h2>
                            <button
                                onClick={onClose}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    color: 'var(--text-secondary)',
                                    fontSize: '24px',
                                    cursor: 'pointer',
                                    padding: 0,
                                    width: '32px',
                                    height: '32px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.color = 'var(--accent-danger)';
                                    e.target.style.transform = 'rotate(90deg)';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.color = 'var(--text-secondary)';
                                    e.target.style.transform = 'rotate(0)';
                                }}
                            >
                                √ó
                            </button>
                        </div>

                        <p style={{
                            color: 'var(--text-secondary)',
                            marginBottom: '24px',
                            fontSize: '15px'
                        }}>
                            Select a game to play with {friend?.friendName}
                        </p>

                        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                            {games.map(game => (
                                <button
                                    key={game.id}
                                    onClick={() => onInvite(game)}
                                    style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '16px',
                                        padding: '16px',
                                        background: 'var(--bg-tertiary)',
                                        border: '1px solid var(--border-color)',
                                        borderRadius: '12px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        textAlign: 'left'
                                    }}
                                    onMouseEnter={(e) => {
                                        e.currentTarget.style.borderColor = game.color;
                                        e.currentTarget.style.transform = 'translateX(4px)';
                                    }}
                                    onMouseLeave={(e) => {
                                        e.currentTarget.style.borderColor = 'var(--border-color)';
                                        e.currentTarget.style.transform = 'translateX(0)';
                                    }}
                                >
                                    <div style={{
                                        width: '60px',
                                        height: '60px',
                                        borderRadius: '10px',
                                        background: `linear-gradient(135deg, ${game.color}40, ${game.color}20)`,
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontSize: '28px'
                                    }}>
                                        üéÆ
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{
                                            fontSize: '12px',
                                            color: game.color,
                                            fontWeight: '700',
                                            textTransform: 'uppercase',
                                            letterSpacing: '1px',
                                            marginBottom: '4px'
                                        }}>
                                            {game.category}
                                        </div>
                                        <div style={{
                                            fontSize: '16px',
                                            fontWeight: '700'
                                        }}>
                                            {game.title}
                                        </div>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Game Player Component
        function GamePlayer({ game, onExit }) {
            const [isFullscreen, setIsFullscreen] = useState(false);

            const toggleFullscreen = () => {
                const elem = document.getElementById('game-player');
                if (!document.fullscreenElement) {
                    elem.requestFullscreen();
                    setIsFullscreen(true);
                } else {
                    document.exitFullscreen();
                    setIsFullscreen(false);
                }
            };

            return (
                <div id="game-player" style={{
                    position: 'fixed',
                    inset: 0,
                    background: '#000',
                    display: 'flex',
                    flexDirection: 'column',
                    zIndex: 9999
                }}>
                    {/* Game Header */}
                    <div style={{
                        background: 'rgba(0, 0, 0, 0.95)',
                        padding: '16px 24px',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        borderBottom: '1px solid var(--border-color)'
                    }}>
                        <h2 style={{
                            fontSize: '20px',
                            fontWeight: '700',
                            margin: 0,
                            fontFamily: 'Space Mono, monospace'
                        }}>
                            {game.title}
                        </h2>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={toggleFullscreen}
                                style={{
                                    padding: '10px 20px',
                                    background: 'rgba(0, 255, 136, 0.2)',
                                    border: '1px solid var(--accent-primary)',
                                    borderRadius: '8px',
                                    color: 'var(--accent-primary)',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.background = 'var(--accent-primary)';
                                    e.target.style.color = '#000';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.background = 'rgba(0, 255, 136, 0.2)';
                                    e.target.style.color = 'var(--accent-primary)';
                                }}
                            >
                                {isFullscreen ? '‚õ∂ Exit Fullscreen' : '‚õ∂ Fullscreen'}
                            </button>

                            <button
                                onClick={onExit}
                                style={{
                                    padding: '10px 20px',
                                    background: 'rgba(255, 68, 102, 0.2)',
                                    border: '1px solid var(--accent-danger)',
                                    borderRadius: '8px',
                                    color: 'var(--accent-danger)',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.background = 'var(--accent-danger)';
                                    e.target.style.color = '#fff';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.background = 'rgba(255, 68, 102, 0.2)';
                                    e.target.style.color = 'var(--accent-danger)';
                                }}
                            >
                                ‚úï Exit Game
                            </button>
                        </div>
                    </div>

                    {/* Game iframe */}
                    <div style={{ flex: 1, position: 'relative' }}>
                        <iframe
                            src={game.url}
                            style={{
                                width: '100%',
                                height: '100%',
                                border: 'none'
                            }}
                            allowFullScreen
                            allow="autoplay; fullscreen"
                        />
                    </div>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
