<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Music Player with Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #121212;
      color: white;
    }
    #player {
      width: 100%;
      height: 400px;
      margin: 20px 0;
    }
    #search {
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    #results {
      margin-top: 20px;
    }
    .track {
      padding: 10px;
      border-bottom: 1px solid #333;
      cursor: pointer;
    }
    .track:hover {
      background: #222;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      cursor: pointer;
    }
    #auth {
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>YouTube Music Player</h1>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="login">Login</button>
    <button id="signup">Sign Up</button>
    <button id="logout" style="display: none;">Logout</button>
  </div>

  <input type="text" id="search" placeholder="Search for music..." />
  <button id="search-btn">Search</button>

  <div id="player"></div>

  <div class="controls">
    <button id="play">Play</button>
    <button id="pause">Pause</button>
    <button id="prev">Previous</button>
    <button id="next">Next</button>
  </div>

  <div id="results"></div>

  <script>
    // Supabase config
    const supabaseUrl = 'YOUR_SUPABASE_URL';
    const supabaseKey = 'YOUR_SUPABASE_KEY';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // DOM elements
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login');
    const signupBtn = document.getElementById('signup');
    const logoutBtn = document.getElementById('logout');
    const searchInput = document.getElementById('search');
    const searchBtn = document.getElementById('search-btn');
    const playerDiv = document.getElementById('player');
    const resultsDiv = document.getElementById('results');
    const playBtn = document.getElementById('play');
    const pauseBtn = document.getElementById('pause');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');

    // YouTube player
    let player;
    let currentVideoId = null;
    let searchResults = [];

    // Auth state
    supabase.auth.onAuthStateChange((event, session) => {
      if (session) {
        logoutBtn.style.display = 'inline';
        loginBtn.style.display = 'none';
        signupBtn.style.display = 'none';
      } else {
        logoutBtn.style.display = 'none';
        loginBtn.style.display = 'inline';
        signupBtn.style.display = 'inline';
      }
    });

    // Auth event listeners
    loginBtn.addEventListener('click', () => {
      supabase.auth.signInWithPassword({
        email: emailInput.value,
        password: passwordInput.value
      }).catch(error => alert(error.message));
    });

    signupBtn.addEventListener('click', () => {
      supabase.auth.signUp({
        email: emailInput.value,
        password: passwordInput.value
      }).catch(error => alert(error.message));
    });

    logoutBtn.addEventListener('click', () => {
      supabase.auth.signOut();
    });

    // YouTube API
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '390',
        width: '100%',
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      event.target.playVideo();
    }

    function onPlayerStateChange(event) {
      // Handle player state changes
    }

    // Load YouTube API script
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // Search YouTube
    searchBtn.addEventListener('click', () => {
      const query = searchInput.value;
      fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&type=video&key=YOUR_YOUTUBE_API_KEY`)
        .then(response => response.json())
        .then(data => {
          searchResults = data.items;
          displayResults(data.items);
        });
    });

    function displayResults(items) {
      resultsDiv.innerHTML = '';
      items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'track';
        div.textContent = item.snippet.title;
        div.addEventListener('click', () => {
          currentVideoId = item.id.videoId;
          player.loadVideoById(currentVideoId);
        });
        resultsDiv.appendChild(div);
      });
    }

    // Player controls
    playBtn.addEventListener('click', () => {
      player.playVideo();
    });

    pauseBtn.addEventListener('click', () => {
      player.pauseVideo();
    });

    prevBtn.addEventListener('click', () => {
      // Implement previous track logic
    });

    nextBtn.addEventListener('click', () => {
      // Implement next track logic
    });
  </script>
</body>
</html>
